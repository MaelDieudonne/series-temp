**Pré-requis**

```{r include=FALSE}
install.packages("fUnitRoots")
library(fUnitRoots)
library(MASS)
library(zoo)
```

**Téléchargement puis extraction des données**

Première tentative avec la production d'explosifs, mais série chaotique, avec une variance croissant fortement au cours du temps.

```{r}
file_url <- "https://www.insee.fr/fr/statistiques/serie/telecharger/csv/010767819?ordre=antechronologique&transposition=donneescolonne&periodeDebut=1&anneeDebut=1990&periodeFin=1&anneeFin=2024&revision=sansrevisions"

local_file_name <- "data.zip"
download.file(file_url, local_file_name, mode = "wb")

file_list <- unzip(local_file_name)
file.rename(file_list[2], "valeurs_mensuelles.csv")

file.remove("data.zip")
file_list[2] <- sub("^\\.\\/", "", file_list[2])
file_list[2] <- sub("/valeurs_mensuelles\\.csv$", "", file_list[2]) 
unlink(file_list[2], recursive = TRUE)

rm(file_url, local_file_name, file_list)
```

**Conversion au format Zoo**

```{r}
data <- read.csv("valeurs_mensuelles.csv", sep = ";")
data <- data[-c(1:3), -3]
colnames(data) <- c("dates", "values")

data <- data[order(data$dates), ]
rownames(data) <- NULL

data$dates <- as.yearmon(data$dates)
data$values <- as.numeric(data$values)

raw_series <- zoo(data$values, order.by=data$dates)
```

# Partie I : données

```{r}
plot(raw_series, main = "Undifferenciated series", xlab = "Date", ylab = "Value")
```

On observe une double tendance : croissance de la moyenne et de la variance.

```{r}
diff_series <- diff(raw_series, 1)
plot(diff_series, main = "1-differenciated series", xlab = "Date", ylab = "Value")
```

Une différenciation simple suffit à stabiliser la moyenne, mais pas la variance. Pas d'autre choix qu'une transformation Box-Cox ?

```{r}
lambda_seq <- seq(-2, 2, by = 0.2)
boxcox_result <- boxcox(raw_series ~ 1, lambda = lambda_seq)

optimal_lambda <- boxcox_result$x[which.max(boxcox_result$y)]
print(optimal_lambda)

transformed_series <- if (abs(optimal_lambda) < 1e-8) log(raw_series) else (raw_series^optimal_lambda - 1) / optimal_lambda

plot(transformed_series)

diff_series <- diff(transformed_series, 1)
plot(diff_series)
```

```{r}
cube_root_series <- raw_series^(1/2)
plot(cube_root_series)
diff_series <- diff(cube_root_series, 1)
plot(diff_series)
```


# Partie II : modèles ARMA

```{r}

```

# Partie III : Prévision

```{r}

```
